
âŸ¨GnuplotâŸ© â† â€¢Import "Gnuplot.bqn"

#################################################################
###  Statistical Functions
#################################################################

### Rolling Mean, tested against Pandas .rolling().mean()
WMeanâ† {+`(ğ•©-(-ğ•¨)â†“(ğ•¨â¥Š0)âˆ¾ğ•©)Ã·ğ•¨}
2 WMean 1+â†•100
1+â†•100
Â¯4â†‘3 WMean â‹†âŸœ1.2 â†•20

### EMA 
Emaâ†{kâ†2Ã·1+ğ•¨â‹„{(kÃ—ğ•©)+ğ•¨Ã—1-k}`ğ•©} 
50 Ema â†•1e1

### Variance Welford's method, tested against Numpy np.var([])
# https://jonisalonen.com/2013/deriving-welfords-method-for-computing-variance/
Varâ†{nâ€¿mâ€¿sâ†1â€¿0â€¿0{
  kâ€¿mâ€¿sâ†ğ•©â‹„
    newMâ†m+(ğ•¨-m)Ã·kâ‹„
	  (k+1)â€¿newMâ€¿(s+(ğ•¨-newM)Ã—(ğ•¨-m))
	}Â´âŒ½ğ•©â‹„
	sÃ·n-1}
 Var 10Ã·Ëœ1+â†•2
Var â‹†âŸœ1.2 â†•20
âŠ‘2+â†•10

### ROlling Variance, tested against Pandas.rolling().var(ddof=1)
# Source: https://jonisalonen.com/2014/efficient-and-accurate-rolling-standard-deviation/
# Another similar algorithm here () https://www.dfki.de/fileadmin/user_upload/import/7051_131008_Memory_and_Processing_Efficient_Formula_for_Moving_Variance_Calculation_in_EEG_and_EMG_Signal_Processing_NEUROTECHNIX_Krell.pdf
WVar â† {vâ†Var ğ•¨â†‘ğ•©â‹„
 mmâ†(Â»+âŠ¢) ğ•¨ WMean ğ•©â‹„
 x0â†(ğ•¨â¥Š0)Â»ğ•©â‹„
 zâ†(ğ•©-x0)Ã—(ğ•©+x0-mm)â‹„
 (0â¥ŠËœğ•¨-1)âˆ¾ (ğ•¨-1)Ã·Ëœ +`(vÃ—ğ•¨)âˆ¾ğ•¨â†“zâ‹„
} 
3 WVar â‹†âŸœ1.2 â†•20

### Rolling Std, Tested against Pandas.rolling(w).std(ddof=1)
WStd â† âˆšâˆ˜WVar

Â¯4â†‘3 WStd â‹†âŸœ1.2 â†•20

#-âŸœÂ» 
### Bins and Quantiles

GBars â† {
	plt â† Gnuplot "
		title '"âˆ¾ğ•¨âˆ¾"' font ',18'
		terminal wxt size 1300,600
		style line 5 lt rgb 'cyan' lw 3 pt 6"
	plt.Plot ğ•©â€¿"using 1:2 with boxes fillstyle pattern 5 title ''"
	"gnuplot-histogram-1.txt" â€¢file.Chars plt.Debug @
	â€¢SH "gnuplot"â€¿"-persist"â€¿"gnuplot-histogram-1.txt"
} 
### Cumulative Bins aka Cumulative Probability Density
CumBins â† {
	soâ†âˆ§ğ•©â‹„
	staâ€¿endâ†0â€¿Â¯1âŠsoâ‹„
  lsâ†sta+((1eÂ¯3Ã·ğ•¨)+1+â†•ğ•¨)Ã—(end-sta)Ã·ğ•¨â‹„
	cuxâ†+Ësoâ‰¤âŒœlsâ‹„
	cux â‰ ls
} 
#âŒ½Ë˜â‰50 CumBins 1000Ã·Ëœ1+â†•100

### Cumulative Distribution Diagram
#"Cumulative Counts" GBars âŒ½Ë˜â‰50 CumBins 1000Ã·Ëœ â‹†âŸœ1.8 1+â†•100
 CumBinsPct â† (((âŠ¢Ã·âŸ¨Â¯1âŸ©âŠ¸âŠ‘)0âŠ¸âŠ)â‰1âŠ¸âŠ)âˆ˜CumBins 
#â‰500 CumBinsPct 1+â†•100
#"Cumulative Percentage" GBars âŒ½Ë˜â‰50 CumBinsPct â‹†âŸœ2.5 1+â†•100
### Bins aka Distribution Histogram
HBins â† {
	soâ†âˆ§ğ•©â‹„
	staâ€¿endâ†0â€¿Â¯1âŠsoâ‹„
  lsâ†sta+((1eÂ¯3Ã·ğ•¨)+1+â†•ğ•¨)Ã—(end-sta)Ã·ğ•¨â‹„
	cuxâ†+Ësoâ‰¤âŒœlsâ‹„
	tvâ†-âŸœÂ» cuxâ‹„ #number of values to take into every bin
	tv /âŠ¸âŠ” soâ‹„
}

#20 HBins â‹†âŸœ2 â†•10
### Histogram
Hist â† "Histogram" GBars (>(+Â´(Ã·â‹ˆâŠ¢)â‰ )Â¨)âˆ˜HBins 
#100 Hist  â‹†âŸœ2 â†•10

### Histogram in %
#30 (â‰âˆ˜>âˆ˜((0âŠ¸âŠ)â‰((âŠ¢Ã·+Â´)1âŠ¸âŠ))âˆ˜â‰âˆ˜>(+Â´(Ã·â‹ˆâŠ¢)â‰ )Â¨)âˆ˜HBins 2000+ â‹†âŸœ3 Â¯5000+â†•10000

PHist â† "Histogram" GBars (â‰âˆ˜>âˆ˜((0âŠ¸âŠ)â‰((âŠ¢Ã·+Â´)1âŠ¸âŠ))âˆ˜â‰âˆ˜>(+Â´(Ã·â‹ˆâŠ¢)â‰ )Â¨)âˆ˜HBins 
#30 PHist 2000+ â‹†âŸœ3 Â¯5000+â†•10000


csv â† "',/" â€¢Import "./bqn-libs/csv.bqn"  # Easier characters to write
cldir â† "/media/grenada/Data/Crypto-Historical-Data/data-csv/binance/"

LoadCandles â† { 
	baseâ€¿quoteâ†ğ•¨â‹„
	timeframeâ†ğ•©â‹„
	>â€¢ParseFloatÂ¨Â¨ 1â†“ csv.SplitL â€¢FLines cldir âˆ¾baseâˆ¾"_"âˆ¾quoteâˆ¾"-"âˆ¾timeframeâˆ¾".csv"â‹„
}
#10â†‘âŸ¨"BTC","USDT"âŸ© LoadCandles "1d"


#################################################################
### Ichimoku Cloud 
#################################################################
Ichimoku â† {
	conâ€¿banâ€¿bnâ†ğ•¨â‹„
	col â† Ã·âŸœ2 +Â´âŒˆâ€¿âŒŠ {(0â¥ŠËœcon-1)âˆ¾ğ• ËË˜ conâ†•ğ•©}Â¨ â‹ˆËâ‰2â€¿3âŠ¸âŠË˜ğ•©â‹„
	bal â† Ã·âŸœ2 +Â´âŒˆâ€¿âŒŠ {(0â¥ŠËœban-1)âˆ¾ğ• ËË˜ banâ†•ğ•©}Â¨ â‹ˆËâ‰2â€¿3âŠ¸âŠË˜ğ•©â‹„
	lesA â† (banâ¥Š0)Â» Ã·âŸœ2 col + balâ‹„
	lesB â† (banâ¥Š0)Â» Ã·âŸœ2 +Â´âŒˆâ€¿âŒŠ {(0â¥ŠËœbn-1)âˆ¾ğ• ËË˜ bnâ†•ğ•©}Â¨ â‹ˆËâ‰2â€¿3âŠ¸âŠË˜ğ•©â‹„
	colâ€¿balâ€¿lesAâ€¿lesB
}

PlotIchimoku â† {
	baseâ€¿quoteâ†ğ•¨â‹„
	timeframeâ†ğ•©â‹„
	
	dcv â†500â†‘baseâ€¿quote LoadCandles timeframeâ‹„
	clâ†Â¯2âŠË˜dcvâ‹„
	colâ€¿balâ€¿lesAâ€¿lesB â† 30â€¿60â€¿120 Ichimoku dcvâ‹„
	ixs â† â†•â‰ dcvâ‹„
	plt â† Gnuplot "
		title 'Ichimoku Cloud' font ',18'
		terminal wxt size 1800,900
		style line 5 lt rgb 'cyan' lw 3 pt 6"
	plt.Plot (â‰>ixsâ€¿lesAâ€¿lesB)â€¿" with filledcurves fs solid 0.1"
	plt.Plot (â‰>ixsâ€¿cl)â€¿"lw 1 lc rgb 'black' with lines"
	plt.Plot (â‰>ixsâ€¿col)â€¿"lw 1 lc rgb '#5555CC' with lines"
	plt.Plot (â‰>ixsâ€¿bal)â€¿"lw 1 lc rgb 'red' with lines"
	plt.Plot (â‰>ixsâ€¿lesA)â€¿"lw 1 lc rgb 'gray' with lines"
	plt.Plot (â‰>ixsâ€¿lesB)â€¿"lw 1 lc rgb 'gray' with lines"
	"gnuplot-ichimoku-1.txt" â€¢file.Chars plt.Debug @
	â€¢SH "gnuplot"â€¿"-persist"â€¿"gnuplot-ichimoku-1.txt"
}
#"BTC"â€¿"USDT" PlotIchimoku "1d"
###

#################################################################
### Directional Change / ZigZag Algorithm 
#################################################################
IfElse â† {condâ€¿Trueâ€¿False: condâ—¶Falseâ€¿True @}
TestConds â† {fnâ†{Condâ€¿Act ğ•Š else: Condâ—¶Elseâ€¿Act}Â´ğ•© â‹„ Fn@}
clâ† â‹†â¼ Â¯2âŠ¸âŠË˜ "BTC"â€¿"USDT" LoadCandles "1d"
Peaks â† {
	qdcâ†ğ•¨â‹„
	1â†“âŒ½Â¯1âŠ‘(0â€¿1â€¿0â€¿(âŠ‘ğ•©)â€¿(â‰0â€¿0)) {
		ixâ€¿dirâ€¿xiâ€¿xpâ€¿evxâ†ğ•©
		pâ†ğ•¨
		naccâ† TestConds âŸ¨
			(0<dirÃ—p-xp)â€¿		{ğ•¤â‹„dirâ€¿ixâ€¿pâ€¿evx}		# Continues in the same direction as before, update xi & xp
			{qdcâ‰¥dirÃ—-p-xp}â€¿	{ğ•¤â‹„dirâ€¿xiâ€¿xpâ€¿evx}		# Opposite direction, below threshold, keep previous xi & xp
											{ğ•¤â‹„(-dir)â€¿ixâ€¿pâ€¿((xiâ€¿dir)âˆ¾evx)} # Opposite direction, above threshold, change direction
		âŸ©
		(ix+1)âˆ¾nacc
	}Â´ âŒ½ğ•©â‹„
}
pks â† 0.20 Peaks cl 
pixâ†0âŠ‘Ë˜pks
pcpixâ†pixâŠ¸âŠcl
0.15>|-Ëpcpixâ‰Â»pcpix
ixsâ†â†•â‰ cl
plt â† Gnuplot "
	title 'ZigZag Algorithm' font ',18'
	terminal wxt size 1800,900
	style line 1 lt rgb 'black' lw 1"
plt.Plot (â‰>pixâ€¿pcpix)â€¿" lw 2 lc rgb 'red' pt 7 ps 3"
plt.Plot (â‰>ixsâ€¿cl)â€¿"lw 1 lc rgb 'black' with lines"
"gnuplot-zigzag-1.txt" â€¢file.Chars plt.Debug @
â€¢SH "gnuplot"â€¿"-persist"â€¿"gnuplot-zigzag-1.txt"
18541.28 Ã· 18325.11 -1 






stds â† 14 WStd cl
ixsâ†(â†•â‰ cl)
â‰>ixsâ€¿cl
emaBo â† 21 Ema cl
boLâ€¿boH â† (<emaBo) +Ë˜ âŸ¨Â¯1,1âŸ©Ã—Â¨<stds
#â‰ bol
cl
#â‰>ixsâ€¿emaBo

plt â† Gnuplot "
  title 'Price and EMA' font ',18'
	terminal wxt size 1300,600
	style line 5 lt rgb 'cyan' lw 3 pt 6
"
4â†‘â‰>ixsâ€¿cl
plt.Plot (â‰>ixsâ€¿cl)â€¿"lw 0.5 lc rgb 'blue' with lines"
plt.Plot (â‰>ixsâ€¿emaBo)â€¿"lw 0.5 lc rgb 'black' with lines"
plt.Plot (â‰>ixsâ€¿boL)â€¿"lw 0.5 lc rgb 'green' with lines"
plt.Plot (â‰>ixsâ€¿boH)â€¿"lw 0.5 lc rgb 'red' with lines"
# ZigZag like neurotrader


"gnuplot-example-1.txt" â€¢file.Chars plt.Debug @

0.1 {ğ•©} cl



#âŸ¨4â€¿4,0â€¿âˆâŸ© âŠ‘ dcv


#hwâ†"h"
#hwâ†©"Hello "â€¿"World!"
#â¥ŠÂ¨hw
 
