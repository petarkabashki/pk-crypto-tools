
âŸ¨GnuplotâŸ© â† â€¢Import "Gnuplot.bqn"

âŸ¨JParseâ‡Parse,JExportâ‡ExportâŸ©â†â€¢Import "bqn-libs/json.bqn"
âŸ¨Split , Join,  SplitL, JoinLâŸ©â†â€¢Import "bqn-libs/csv.bqn"
âŸ¨MP, Cholesky,InverseâŸ©â†â€¢Import "bqn-libs/matrix.bqn"
#1â€¿1 MP 2â€¿2â¥Š4
âŸ¨FmtNs, GLine, WMean, Ema, Var, WVar, WStd, GBars, CumBins, CumBinsPct, HBins, Hist, PHistâŸ©â†â€¢Import "pk-libs.bqn"

csv â† "',/" â€¢Import "./bqn-libs/csv.bqn"  # Easier characters to write
csvdir â† "/media/grenada/Data/Crypto-Historical-Data/data-csv/binance/"

LdCsv â† { 
	baseâ€¿quoteâ†ğ•¨â‹„
	timeframeâ†ğ•©â‹„
	>â€¢ParseFloatÂ¨Â¨ 1â†“ csv.SplitL â€¢FLines csvdir âˆ¾baseâˆ¾"_"âˆ¾quoteâˆ¾"-"âˆ¾timeframeâˆ¾".csv"â‹„
}
#10â†‘âŸ¨"BTC","USDT"âŸ© LoadCandles "1d"

jsondirâ†"/media/mu6mula/Data/Crypto-Data-Feed/freq-user-data/data/binance/"
LdJson â†{ 
	>JParse â€¢FChars jsondirâˆ¾(âŠ‘ğ•©)âˆ¾"_"âˆ¾(1âŠ‘ğ•©)âˆ¾"-"âˆ¾(ğ•¨)âˆ¾".json"
}
#  "1d" LdJson "BTC"â€¿"USDT" 
#LdJsLc â† {â‹†â¼ Â¯2âŠË˜ ğ•¨ LdJson ğ•©â€¿"USDT"}


#LnOhlcâ† {â‹†â¼ Â¯1â†“Ë˜1â†“Ë˜ ğ•¨ LdJson ğ•©â€¿"USDT"} 
# lohlcâ† "1d" LnOhlc "AVAX"



#################################################################
### Directional Change / ZigZag Algorithm 
#################################################################
IfElse â† {condâ€¿Trueâ€¿False: condâ—¶Falseâ€¿True @}
TestConds â† {fnâ†{Condâ€¿Act ğ•Š else: Condâ—¶Elseâ€¿Act}Â´ğ•© â‹„ Fn@}

ohlcâ† Â¯1000â†‘ "4h" LdJson "BTC"â€¿"USDT"
clâ† â‹†â¼ Â¯2âŠ¸âŠË˜ ohlc
Peaks â† {
	qdcâ†ğ•¨â‹„
	âŒ½Â¯1âŠ‘(0â€¿1â€¿0â€¿(âŠ‘ğ•©)â€¿(â‰0â€¿0)) {
		ixâ€¿dirâ€¿xiâ€¿xpâ€¿evxâ†ğ•©
		pâ†ğ•¨
		naccâ† TestConds âŸ¨
			(0<dirÃ—p-xp)â€¿		{ğ•¤â‹„dirâ€¿ixâ€¿pâ€¿evx}		# Continues in the same direction as before, update xi & xp
			{qdcâ‰¥dirÃ—-p-xp}â€¿	{ğ•¤â‹„dirâ€¿xiâ€¿xpâ€¿evx}		# Opposite direction, below threshold, keep previous xi & xp
											{ğ•¤â‹„(-dir)â€¿ixâ€¿pâ€¿((xiâ€¿dir)âˆ¾evx)} # Opposite direction, above threshold, change direction
		âŸ©
		(ix+1)âˆ¾nacc
	}Â´ âŒ½ğ•©â‹„
}
pks â† 0.10 Peaks cl 
pixâ†0âŠ‘Ë˜pks
pcpixâ†pixâŠ¸âŠcl
0.15>|-Ëpcpixâ‰Â»pcpix
ixsâ†â†•â‰ cl
plt â† Gnuplot "
	title 'ZigZag Algorithm' font ',18'
	terminal wxt size 1800,900
	style line 1 lt rgb 'black' lw 1"
plt.Plot (â‰>pixâ€¿pcpix)â€¿" lw 2 lc rgb 'red' pt 7 ps 3"
plt.Plot (â‰>ixsâ€¿cl)â€¿"lw 1 lc rgb 'black' with lines"
"gnuplot-zigzag-1.txt" â€¢file.Chars plt.Debug @
â€¢SH "gnuplot"â€¿"-persist"â€¿"gnuplot-zigzag-1.txt"
18541.28 Ã· 18325.11 -1 

0
